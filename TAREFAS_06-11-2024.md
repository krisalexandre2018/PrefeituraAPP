# ğŸ“… TAREFAS PARA 06/11/2024 (Quarta-feira)

## ğŸ¯ Tarefas PrioritÃ¡rias do Dia

### 1. ğŸ”´ Corrigir Credenciais do Cloudinary (URGENTE)
**Por quÃª**: Upload de fotos estÃ¡ falando com erro "Invalid Signature"

**Problema Identificado**:
- Cloud Name estava incorreto (`dzjhfexow` â†’ correto: `doalug1yw`)
- API Secret pode estar incorreto ou com formataÃ§Ã£o errada
- Backend nÃ£o recarregou as variÃ¡veis de ambiente apÃ³s mudanÃ§a no .env

**Passos**:
- [ ] Acessar Cloudinary Dashboard: https://cloudinary.com/console
- [ ] Copiar as credenciais corretas (todas sem aspas):
  - `Cloud Name`
  - `API Key`
  - `API Secret`
- [ ] Abrir arquivo `backend/.env`
- [ ] Atualizar as credenciais (SEM ASPAS):
  ```env
  CLOUDINARY_CLOUD_NAME=doalug1yw
  CLOUDINARY_API_KEY=<copiar_exato_do_dashboard>
  CLOUDINARY_API_SECRET=<copiar_exato_do_dashboard>
  ```
- [ ] **IMPORTANTE:** Reiniciar o backend manualmente:
  ```bash
  # No terminal onde o backend estÃ¡ rodando:
  # Pressionar Ctrl+C para parar
  cd "E:\Todos os projetos\Prefeitura App\backend"
  npm run dev
  ```
- [ ] Testar criaÃ§Ã£o de ocorrÃªncia com foto

**Tempo estimado**: 15 minutos

---

### 2. ğŸŸ¡ Testar CriaÃ§Ã£o de OcorrÃªncia com Fotos
**Por quÃª**: Validar que o Cloudinary estÃ¡ funcionando corretamente

**Passos**:
- [ ] No app mobile, estar logado como vereador:
  - Email: vereador@teste.com
  - Senha: 123456
- [ ] Criar uma nova ocorrÃªncia:
  - TÃ­tulo: "Teste de Upload de Fotos"
  - DescriÃ§Ã£o: "Testando upload para Cloudinary"
  - Categoria: INFRAESTRUTURA
  - Prioridade: ALTA
  - Adicionar 2-3 fotos
  - EndereÃ§o: Digitar manualmente (ex: "Rua Principal, 123")
- [ ] Verificar se a ocorrÃªncia foi criada com sucesso
- [ ] Abrir a ocorrÃªncia e verificar se as fotos aparecem
- [ ] Acessar Cloudinary Dashboard e confirmar upload das imagens

**Tempo estimado**: 10 minutos

---

### 3. ğŸŸ¢ Criar UsuÃ¡rio JURIDICO e Testar PermissÃµes
**Por quÃª**: Validar fluxo completo de atualizaÃ§Ã£o de status de ocorrÃªncias

**Passos**:

**3.1 - Criar usuÃ¡rio JURIDICO:**
- [ ] No app, fazer logout
- [ ] Clicar em "Cadastrar"
- [ ] Preencher dados:
  - Nome: "Maria JurÃ­dica"
  - CPF: "11122233344"
  - Email: "juridico@teste.com"
  - Senha: "123456"
  - Telefone: "11977776666"
  - Tipo: JURIDICO
- [ ] Cadastrar

**3.2 - Aprovar usuÃ¡rio JURIDICO:**
- [ ] Fazer login com Super Admin (krisalexandre2018@gmail.com)
- [ ] Ir em "Gerenciar UsuÃ¡rios"
- [ ] Aprovar "Maria JurÃ­dica"

**3.3 - Testar permissÃµes JURIDICO:**
- [ ] Fazer logout e login com juridico@teste.com / 123456
- [ ] Verificar se visualiza TODAS as ocorrÃªncias (nÃ£o sÃ³ as suas)
- [ ] Abrir a ocorrÃªncia criada pelo vereador
- [ ] Atualizar status: PENDENTE â†’ EM_ANALISE
- [ ] Adicionar comentÃ¡rio no histÃ³rico
- [ ] Atualizar status: EM_ANALISE â†’ RESOLVIDO
- [ ] Verificar se o histÃ³rico foi registrado corretamente

**3.4 - Verificar notificaÃ§Ã£o do vereador:**
- [ ] Fazer logout e login como vereador@teste.com
- [ ] Verificar se recebeu notificaÃ§Ã£o sobre mudanÃ§a de status
- [ ] Abrir a ocorrÃªncia e ver o histÃ³rico completo

**Tempo estimado**: 20 minutos

---

### 4. ğŸŸ¢ Testar Filtros e Buscas
**Por quÃª**: Garantir que filtros estÃ£o funcionando corretamente

**Passos**:
- [ ] Logado como Super Admin ou JURIDICO
- [ ] Na tela Home, testar filtros de status:
  - Todas
  - Pendentes
  - Em AnÃ¡lise
  - Resolvidas
  - Rejeitadas
- [ ] Criar mais ocorrÃªncias com diferentes categorias
- [ ] Testar busca por categoria
- [ ] Testar busca por prioridade

**Tempo estimado**: 15 minutos

---

### 5. ğŸŸ¢ Validar EstatÃ­sticas e RelatÃ³rios
**Por quÃª**: Conferir se contadores e estatÃ­sticas estÃ£o corretos

**Passos**:
- [ ] Logado como Super Admin
- [ ] Ir em "Gerenciar UsuÃ¡rios"
- [ ] Verificar estatÃ­sticas:
  - Total de usuÃ¡rios
  - UsuÃ¡rios por tipo (Admin, Vereador, JurÃ­dico)
  - UsuÃ¡rios por status (Pendentes, Ativos, Inativos)
- [ ] Conferir se nÃºmeros batem com dados reais
- [ ] Testar pull-to-refresh para atualizar dados

**Tempo estimado**: 10 minutos

---

## ğŸ“Š Resumo do Que Foi Feito em 05/11/2024

âœ… **ConcluÃ­do**:
- Cloudinary parcialmente configurado (Cloud Name corrigido de `dzjhfexow` para `doalug1yw`)
- Endpoint de login corrigido para retornar campo `isSuperAdmin`
- BotÃ£o "Gerenciar UsuÃ¡rios" agora aparece para Super Admin
- UsuÃ¡rio VEREADOR criado (vereador@teste.com / 123456)
- Tela de Gerenciar UsuÃ¡rios testada e funcionando

âš ï¸ **Pendente (para 06/11)**:
- **URGENTE:** Corrigir credenciais completas do Cloudinary
- Reiniciar backend para recarregar variÃ¡veis de ambiente
- Testar criaÃ§Ã£o de ocorrÃªncia com upload de fotos
- Criar e testar usuÃ¡rio JURIDICO
- Validar fluxo completo de mudanÃ§a de status
- Testar notificaÃ§Ãµes

---

## ğŸ› Problemas Conhecidos

1. **Cloudinary - Invalid Signature** âŒ
   - **Erro:** `Invalid Signature 81cc1829aeae3f229269ed6e2adab58ff1880b0f`
   - **Causa:** API Secret incorreto ou backend nÃ£o recarregou .env
   - **SoluÃ§Ã£o:** Copiar credenciais exatas do dashboard e reiniciar backend manualmente

2. **Backend nÃ£o recarrega .env automaticamente** âš ï¸
   - Nodemon reinicia o servidor mas o processo Node pode manter variÃ¡veis antigas em cache
   - **SoluÃ§Ã£o:** Sempre parar (Ctrl+C) e reiniciar manualmente apÃ³s mudar .env

3. **GPS nÃ£o funciona em alguns casos** â„¹ï¸
   - Erro: "Current location is unavailable"
   - **SoluÃ§Ã£o:** Sistema jÃ¡ permite criar ocorrÃªncias sem GPS (digitar endereÃ§o manualmente)
   - NÃ£o Ã© bug - Ã© feature opcional

---

## ğŸ” Credenciais de Teste

**Super Admin**:
- Email: krisalexandre2018@gmail.com
- Senha: (sua senha pessoal)
- Status: ATIVO
- Super Admin: true

**Vereador** (criado em 05/11):
- Email: vereador@teste.com
- Senha: 123456
- Tipo: VEREADOR
- Status: ATIVO

**JurÃ­dico** (a criar em 06/11):
- Email: juridico@teste.com
- Senha: 123456
- Tipo: JURIDICO
- Status: PENDENTE â†’ Aprovar via Super Admin

**Backend**:
- URL Local: http://localhost:3000
- URL Rede: http://192.168.2.104:3000
- Banco: vereadores_db (PostgreSQL)

---

## ğŸ’¡ Comandos RÃ¡pidos

```bash
# Parar backend (no terminal onde estÃ¡ rodando)
Ctrl+C

# Iniciar backend
cd "E:\Todos os projetos\Prefeitura App\backend"
npm run dev

# Iniciar mobile
cd "E:\Todos os projetos\Prefeitura App\mobile"
npm start

# Listar usuÃ¡rios no banco
cd "E:\Todos os projetos\Prefeitura App\backend"
node list-users.js

# Abrir Prisma Studio (GUI do banco)
cd "E:\Todos os projetos\Prefeitura App\backend"
npm run prisma:studio
```

---

## ğŸ”§ Troubleshooting Cloudinary

Se continuar dando erro apÃ³s corrigir credenciais:

1. **Verificar se credenciais estÃ£o corretas:**
   ```bash
   cd "E:\Todos os projetos\Prefeitura App\backend"
   node -e "require('dotenv').config(); console.log('Cloud:', process.env.CLOUDINARY_CLOUD_NAME); console.log('Key:', process.env.CLOUDINARY_API_KEY); console.log('Secret:', process.env.CLOUDINARY_API_SECRET.substring(0,5) + '...');"
   ```

2. **Testar upload manual:**
   - Criar script de teste `test-cloudinary.js` no backend
   - Fazer upload de imagem de teste
   - Ver se retorna sucesso ou erro detalhado

3. **Verificar formato do API Secret:**
   - NÃ£o pode ter aspas
   - NÃ£o pode ter espaÃ§os no inÃ­cio/fim
   - Deve ser string alfanumÃ©rica

---

## ğŸ“ Se Precisar de Ajuda

1. Consulte [CHANGELOG.md](./CHANGELOG.md) para histÃ³rico completo
2. Leia [CLAUDE.md](./CLAUDE.md) para orientaÃ§Ãµes do projeto
3. Verifique logs do backend para erros detalhados

---

**Criado em**: 05/11/2024 Ã s 21:30
**Prioridade**: ğŸ”´ Alta (Cloudinary) â†’ ğŸŸ¡ MÃ©dia (Testes) â†’ ğŸŸ¢ Baixa (ValidaÃ§Ãµes)
**Tempo total estimado**: ~70 minutos

---

## ğŸ“ Notas Adicionais

- Hoje (05/11) conseguimos implementar e testar a tela de Gerenciar UsuÃ¡rios com sucesso
- O botÃ£o agora aparece corretamente para Super Admins
- Sistema de permissÃµes estÃ¡ funcionando (erro 403 para usuÃ¡rios sem permissÃ£o)
- Falta apenas resolver o Cloudinary para ter o sistema 100% funcional
